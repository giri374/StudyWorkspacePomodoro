@page
@model MainScreenModel
@{
    Layout = "_Layout";
}

<div class="background" style="background-image: url('@Model.SelectedWorkspaceImage');">
    <div class="top-controls">
        <select asp-for="SelectedWorkspaceId" asp-items="Model.WorkspaceList" onchange="this.form.submit()"></select>
        <select asp-for="SelectedMusicId" asp-items="Model.MusicList" onchange="this.form.submit()"></select>
    </div>

    <div class="workspace-title">
        <h1>@Model.SelectedWorkspaceName</h1>
    </div>

    <div class="pomodoro-box">
        <h2>@Model.Mode</h2>
        @* <h3 id="timer">@Model.TimerDisplay</h3> *@
        
        <h3 id="timer" data-timer="@Model.TimerInSeconds">@Model.TimerDisplay</h3>
        <form method="post">
            <button type="submit" name="action" value="StartPomodoro">Start Pomodoro</button>
            <button type="submit" name="action" value="ShortBreak">Short Break</button>
        </form>
    </div>
</div>
@section Scripts {
    @if (Model.TimerRunning)
    {
        <script>
            window.onload = function () {
                const timerElement = document.getElementById('timer');
                let seconds = parseInt(timerElement.dataset.timer);

                function updateTimerDisplay() {
                    const minutes = Math.floor(seconds / 60);
                    const remainingSeconds = seconds % 60;
                    timerElement.textContent = `${minutes.toString().padStart(2, '0')}:${remainingSeconds.toString().padStart(2, '0')}`;
                }

                if (!isNaN(seconds) && seconds > 0) {
                    const interval = setInterval(() => {
                        if (seconds <= 0) {
                            clearInterval(interval);
                            timerElement.textContent = "Time's up!";
                           //  Optional: trigger bell sound here
                        } else {
                            seconds--;
                            updateTimerDisplay();
                        }
                    }, 1000);

                    updateTimerDisplay(); 
                    // show initial time
                }
            };
        </script>
    }
}