@page
@model MainScreenModel
@{
    Layout = "_Layout";
}
@{
    ViewData["WorkspaceImage"] = Model.SelectedWorkspaceImage;
}

<link rel="stylesheet" href="~/css/workspace.css" />
<link rel="stylesheet" href="~/css/main.css" />

@* <body class="page-container" style="background-image: url('@Model.SelectedWorkspaceImage'); background-size: cover; background-position: center; background-repeat: no-repeat;"> *@
<section class="workspace-container">
    <!-- H·ªôp Pomodoro Timer -->
    <div class="timer-box">
        <div class="mode-switch">
            <span class="mode" onclick="document.querySelector('button[name=action][value=StartPomodoro]').click()">FOCUS</span>
            <span class="mode" onclick="document.querySelector('button[name=action][value=ShortBreak]').click()">SHORT BREAK</span>
            <span class="mode" onclick="document.querySelector('button[name=action][value=LongBreak]').click()">LONG BREAK</span>
        </div>

        <div class="time-display">
            <span id="timer" data-timer="@Model.TimerInSeconds">@Model.TimerDisplay</span>
            <div class="unit-labels">
                <span>MIN</span>
                <span>SEC</span>
            </div>
        </div>

        <form method="post" id="pomodoroForm">
            <button type="submit" name="action" value="StartPomodoro" class="start-btn">START</button>
            <button type="submit" name="action" value="Reset" class="start-btn" style="background-color: #f44336; margin-left: 10px;">RESET</button>
        </form>

        <!-- Audio Elements -->
        <audio id="musicPlayer" preload="auto" loop>
            <source src="@Model.SelectedMusicFile" type="audio/mpeg" />
            <source src="@Model.SelectedMusicFile.Replace(".mp3", ".ogg")" type="audio/ogg" />
            Your browser does not support the audio element.
        </audio>
        
        <audio id="alarmSound" preload="auto">
            <source src="/sounds/alarm.mp3" type="audio/mpeg" />
            <source src="/sounds/alarm.ogg" type="audio/ogg" />
        </audio>
    </div>

    <!-- Khu v·ª±c m·ªü r·ªông b√™n ph·∫£i -->
    <div class="side-panel">
        <!-- H√¨nh n·ªÅn hi·ªán t·∫°i -->
        <div class="preview-box">
            <div class="image-preview" style="background-image: url('@Model.SelectedWorkspaceImage');"></div>
            <p class="preview-label">H√¨nh n·ªÅn: @Model.SelectedWorkspaceName</p>
        </div>

        <!-- Ch·ªçn h√¨nh n·ªÅn kh√°c -->
        <div class="background-picker">
            <label for="workspace-select">Ch·ªçn h√¨nh n·ªÅn:</label>
            <form method="post" id="optionsForm">
                <select id="workspace-select" asp-for="SelectedWorkspaceId" asp-items="Model.WorkspaceList" 
                        onchange="this.form.submit()"></select>
            </form>
        </div>

        <!-- B√†i h√°t hi·ªán t·∫°i -->
        <div class="preview-box">
            <div class="song-icon">üéµ</div>
            <p class="preview-label">B√†i h√°t: @(Model.SelectedMusicId > 0 ? Model.MusicList.FirstOrDefault(m => m.Selected)?.Text : "No music selected")</p>
        </div>

        <!-- Ch·ªçn b√†i h√°t -->
        <div class="background-picker">
            <label for="music-select">Ch·ªçn b√†i h√°t:</label>
            <form method="post" id="musicForm">
                <select id="music-select" asp-for="SelectedMusicId" asp-items="Model.MusicList" 
                        onchange="this.form.submit()"></select>
            </form>
        </div>
    </div>
</section>

@section Scripts {
    <script src="/js/pomodoro.js"></script>
    <script>
        document.addEventListener('DOMContentLoaded', function() {
            const modeSwitch = document.querySelectorAll('.mode');
            const updateActiveMode = () => {
                modeSwitch.forEach(mode => {
                    mode.classList.remove('active');
                    if (mode.textContent === '@Model.Mode'.toUpperCase()) {
                        mode.classList.add('active');
                    }
                });
            };
            updateActiveMode();
        });
    </script>
}